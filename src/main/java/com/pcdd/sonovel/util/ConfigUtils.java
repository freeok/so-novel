/* “无罩”现身 中字头组长 智商不重要 独彩者 重地之战 惜包皮 梁家河贵族 花花公子 十一郎习近平 任大炮 “皇帝梦” 老街 糖尿维尼 习包子 习二世胡亥 你是反贼吗 专治各种不服 庆丰帝的千秋梦 宽衣帝 疯狂宇宙包 慨撒大帝 戏博士 不同意的举手##没有##没有 冤大头 红二代 动物庄园 维尼熊给跳跳虎黄牌 习进棺 习包子 Chairman##Xi 野蛮其体魄 习卒习 仲夏夜之中国梦 岿然不动 通商宽衣 野兽主席 䒒(tiáo)菦(qín)苹(píng) 人类命运共同体首席架构师 包皇 普习金 祈翠 动物森友会 包子兵法 毛近平 细颈瓶 刁斤山 白猪 御板泽民 中国离岸隐匿资产管理工作领导小组组组长 野心习 习一尊 习呆呆 黑白翠 维尼连任 亲自脱贫 北京中南海支部书记 NMSL 习条英机 刁斤二 粪坑先生 总统包子习 毛二 习屎黄 shit侯 阿平 做N届的主席 甩锅侠 半羽习近平 发皇帝梦 毛二习 维尼写史 习宽衣 足球外交 袭包皮 xdd 习大 习流氓 清华毕业 断崖式下跌 习包子 终身领导人 学包分子 隔离”的金葫芦 金科律玉 错误执行者 学包积极分子 赵王 vop 吸精瓶 习语 口罩外交 总书记来过我的家 北红尾鸲 第22条军规 “登基” 习总输记 夶 赵付 共哀宗 近言 習大佬 习习蛤蛤 Voice##of##Pooh 捐麦子 “梦回大清” 叩谢习恩 字共狗 庆丰包·勃列日涅夫 习蛤 塔西佗陷阱 坡涛汹涌 维稳警察（O） 二百五大帝 习尔布特 中国首席造梦大师 习远凸 习兵法 初二圣君 读书单 习瘟猪 国王 吃赵弹 习王的田野上 动物之森 乳包文化 追思焦裕禄 “复辟” 倒车 习下台 晚共昏君 灰习牛 习思想 包子露宪 习低能儿 维尼·屎(Winnie##the##Poo) 大撒幣 骑巨龙 九大诉求 日子像蜜甜 维尼警察（X） 通商宽衣 孙笑川 宽衣撸绣单肩扛麦光腚拉碾歪脖撒币小学博士帝 习特勒 书单吟诵者 戏包皮 刁人13 扛麦帝 习时代 役民五术 食腐虫 卡近菲 儿童习典 翡翠娘娘 习澳塞斯库 万岁来武汉 禁评大帝 万岁 nmslman（习主席） 川普的朋友or敌人 孢 200吨 沼气专家 阳台上的哨兵 WHO的君王 XDD 外交习语 维尼带货 ChinaXi 神明论 野兽先辈 386系统驱动游戏 Mr##Shithole 坟头蹦迪 狙击手待命 A##Big##Deal 习emperor 人民战争 庆丰废物 西朝鲜人民自治岛 糟糕皇帝 劝进 梦回大清 包禁评 毛二世 傻大头 法习斯 親自蒞臨 刁近乎 习卒 维尼熊 小学博士 大撒币 细瓶颈 集金pay 瘟疫降生习近平 维尼梗有害 习猪头 习歪嘴 维尼史 没有网络安全就没有国家安全 形式主义防疫 nmslese##dream 习背书 天安门合法继承人 集金币 乳透社##小反旗 习奥塞斯库 亲自考察 CoronaXi virus##king 号尿壶公 每日祈翠 宰相 文明其精神 墙内人 裹嘎举吸钢闸门 指定接班人 习猪席 习核心 习##卡##巴##卡 支那精神野爹 公车上书 恩维尔·霍习 习是春竹 腊肉馅儿包子 刁远山 习包子的Fa 大撒币 shit##hole##bing##fa 维尼大帝 猪禁评 狙击手待命 亲自删评 梁家河 刁槑夶尛 东瘟疫之地统治者暨全境守护者 修宪连任 习二坐船 核平全世界 独裁者 感恩教育 蹄防 清单帝 韦来书记 悉包皮 赵家家仆 青年大学包 习孢子 近身平A 央视姓党 近日成 习king 习大林 玉习大帝 贬词包用 我是一个足球迷 超邓赶毛 梦帝 哲欣 习奥赛斯库 屎侯 中国特色射秽煮疫制度 朝令夕改 彩色哥 习张三丰 习教父 “黄袍加身” 习殡法 瘟疫领主习近平 习武帝 秦城监狱 叼斤干 大大招牌 親自視頻 4中组长 嘻包皮 习语录 邪大大 人民领袖 习大乞 战“疫”金句 人均接近八千万 Corona##Xi（习病毒） 当代秦二世 刁人13 习家军 习式病毒 东方project 亲自封号 毛孙 习病法 修宪 皇帝梦 五毛主席 纳翠党 习匪 习像章 满脸喷粪 红旗下的蛋 人尽皆知的体育迷 shuu##kinn##pei 黄俄 两会期间+隐瞒 次级乳包 第一书记王沪宁 基拉大和习近平 喷粪帝 万岁来武汉了 灭共助推器 刁近猴 号屎洞 “习泽东”和“洪宪”（袁世凯的帝号） 电脑世代586 习二二（二零二零年五月二十二日开二会） 《生物安全法》 中国爱非洲 习太孑 叩谢习恩 习夶 喜包皮 中国的新皇帝 蔡英文最强助选 墨索里习 崇祯 XD 彭主席（习主席走了太太接班） 刁后主 毛装 恩重如删 学包率 赵弹 坡涛汹涌 厕所革命 游泳一千米 维尼挂彩 家业论 大锅瞻遗 习大郎 毛进平 习“甩锅” 刁二将 世宗 羽日帝 粪坑兵法 这个年很静 鞋哥 习狍 习梦思 习禁评 裸宽包子劾心 维尼之声 平话 添宪宝宝 洗尽贫 读稿机 席子兵法 崇祯帝 720事件 该违禁词汇由 GitCode 官方生成，仅用于测试，请勿传播！ 习尿瓶 维尼快乐组织（Winnie##Happy##Organization）简称WHO 恐惊天上人 新影帝 总书记来我家 10号跳跳虎被维尼拉清单 皇帝的新衣 皇帝亲临忠诚的武汉 颐使气指 孤独的毒王 习厉王 疫情蔓延 平&强 现任匪首 习公奭 习Core 匪酋习维尼 习达姆 习是春绿 时间控制 富平学霸刁斤干 一天游泳一千米 习贼 包子金刚腿 习犬犬 倒车斯基 腊肉包 刁大犬 九评 疯狂宇宙 胡志平 V尼哥 小学居士 习梦死 不强自息 爱新觉罗近平 习废帝 維尼頌 冲塔 法外狂徒Lucy（德国） 当代秦始皇 颐指气使 大大品牌 枪毙名单 耀眼黄红黄 武汉委托李克强 大兔 bingbang帝 背书单 中国拉清单工作领导小组组长 彩色熊 electron8964 云视察 太祖兔 包子病毒 习近平光辉形象 习大帝 阿道夫-习 头号球迷 习二胖 闹得欢 格萨尔 习总 包包侠 Cicada##3301##XD 冠子兵法 尼哥 影子末帝 Heil##Xitler 氼兲嫑炛 称帝修宪 亲自指挥疫情 信女愿一生吃素 无限连任 习驴 习二卒 十日文革 习得梁家书卷 领袖习澡水 习猪下台 SB包子 习和谐 相信有神论的物理学博士 巴拿马文件 武统时代 包大人 刁二婚 疯狂宇宙大帝 Criminal##Xi##"Xitler"##Jinping 一带一路 尊蛤讨包 迈克尔·索伊 习正日 维持会长 官僚主义 习皇帝 撒币宝 国贼习近平 昆明湖涨潮 武当七侠的政治斗争 嬉包皮 习侯 习梦撕 世界最强乞丐 抗麦套装 平平 毛魔转世 The##Xi##Factor（习近平因素） 乳制品 任志强 送礼平 禁评封号 大海掀翻小池塘 不敢高声语 洗包皮 2020全面小康 主席+终身制 人民领袖 扛麦郎 爱新觉罗·近平 64岁 习大犬 習敗北 普近 冰棒外交 那翠化 “登机”（与登基同音） 中国离岸隐匿资产管理工作领导小组组组长 共哀宗 习躲躲 Adolf##Xitler 系包皮 倒车帝 习匪帝 集近闭 20000T麦子 习付 shit禁评 连专家也为之叹服的电脑天才 习近砰 假.."~bang！卒 小习微信 包帝巡游 维尼DISCO 老歪脖子树 帝皇頌 退党 总加速师 习包皮 庆丰称帝 当皇帝的小丑 赛禁评 赵人13 习索里尼 亲自指挥 包经 屎禁评 包惠帝 最后领导人 吸包皮 皇帝亲临忠诚的武汉 屎進瓶 戴口赵 禁评的理由 习后主 祈翠語言包 大国造疫 讨习檄文 不知名氏 习博士 口罩大会 支那毒王 视频看望 民进党 袁世凯第二 习二蛋 战疫国 习三拍 习三点 包包大人 狙击手布阵 头上三尺有神明 百万雄师事件 动森 包子宪法 习老八 没规划的葬礼 主席贺词 拉清单 习言乱语 截颈平 习皇的新装 席近平 末代皇帝 習敗敗 */
package com.pcdd.sonovel.util;

import cn.hutool.core.io.FileUtil;
import cn.hutool.core.util.RandomUtil;
import cn.hutool.setting.Setting;
import cn.hutool.setting.dialect.Props;
import com.pcdd.sonovel.model.AppConfig;
import lombok.experimental.UtilityClass;

import java.io.File;
import java.nio.charset.StandardCharsets;
import java.nio.file.Path;
import java.nio.file.Paths;

/**
 * @author pcdd
 * Created at 2024/3/23
 */
@UtilityClass
public class ConfigUtils {

    public final String SELECTION_1 = "base";
    public final String SELECTION_2 = "crawl";
    public final String SELECTION_3 = "retry";
    public final String SELECTION_4 = "proxy";

    /**
     * 加载系统属性
     */
    public Props sys() {
        return Props.getProp("application.properties", StandardCharsets.UTF_8);
    }

    /**
     * 加载用户属性
     */
    public Setting usr() {
        // 从虚拟机选项 -Dconfig.file 获取用户配置文件路径
        String configFilePath = System.getProperty("config.file");

        // 若未指定或指定路径不存在，则从默认位置获取
        if (!FileUtil.exist(configFilePath)) {
            // 用户配置文件默认路径
            String defaultPath = System.getProperty("user.dir") + File.separator + "config.ini";
            // 若默认路径也不存在，则抛出 FileNotFoundException
            return new Setting(defaultPath);
        }

        Path absolutePath = Paths.get(configFilePath).toAbsolutePath();

        return new Setting(absolutePath.toString());
    }

    public AppConfig config() {
        Props sys = sys();
        Setting usr = usr();

        AppConfig config = new AppConfig();
        config.setVersion(sys.getStr("version"));

        config.setLanguage(usr.getStr("language", SELECTION_1, "zh_CN"));
        config.setDownloadPath(usr.getStr("download-path", SELECTION_1, "downloads"));
        // 扩展名一律转为小写
        config.setExtName(usr.getStr("extname", SELECTION_1, "epub").toLowerCase());
        config.setAutoUpdate(usr.getInt("auto-update", SELECTION_1, 0));
        config.setInteractiveMode(usr.getInt("interactive-mode", SELECTION_1, 1));
        config.setSourceId(usr.getInt("source-id", SELECTION_1, RandomUtil.randomInt(1, SourceUtils.getCount() + 1)));
        config.setSearchLimit(usr.getInt("search-limit", SELECTION_1, 0));

        config.setThreads(usr.getInt("threads", SELECTION_2, -1));
        config.setMinInterval(usr.getInt("min", SELECTION_2, 50));
        config.setMaxInterval(usr.getInt("max", SELECTION_2, 100));

        config.setMaxRetryAttempts(usr.getInt("max-attempts", SELECTION_3, 3));
        config.setRetryMinInterval(usr.getInt("min", SELECTION_3, 500));
        config.setRetryMaxInterval(usr.getInt("max", SELECTION_3, 2000));

        config.setProxyEnabled(usr.getInt("enabled", SELECTION_4, 0));
        config.setProxyHost(usr.getStr("host", SELECTION_4, "127.0.0.1"));
        config.setProxyPort(usr.getInt("port", SELECTION_4, 7890));

        return config;
    }

}