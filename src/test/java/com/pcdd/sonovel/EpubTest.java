/* 独裁者 主席+终身制 刁槑夶尛 富平学霸刁斤干 习匪帝 “皇帝梦” 头号球迷 红二代 儿童习典 维尼梗有害 习##卡##巴##卡 细瓶颈 爱新觉罗近平 东方project “登机”（与登基同音） 领袖习澡水 邪大大 满脸喷粪 习二卒 坟头蹦迪 毛进平 崇祯帝 习思想 包包大人 氼兲嫑炛 小学博士 傻大头 蔡英文最强助选 支那毒王 超邓赶毛 习大 大国造疫 亲自指挥疫情 这个年很静 基拉大和习近平 尊蛤讨包 悉包皮 枪毙名单 韦来书记 初二圣君 吸包皮 蹄防 耀眼黄红黄 习奥赛斯库 习猪头 猪禁评 V尼哥 习特勒 “梦回大清” 最后领导人 习三拍 习近平光辉形象 维尼史 shit##hole##bing##fa 中国离岸隐匿资产管理工作领导小组组组长 386系统驱动游戏 通商宽衣 习猪席 嘻包皮 时间控制 每日祈翠 武当七侠的政治斗争 游泳一千米 糖尿维尼 坡涛汹涌 头上三尺有神明 维尼DISCO 任志强 疯狂宇宙包 人均接近八千万 刁近乎 习低能儿 大大品牌 野蛮其体魄 习卒习 维尼之声 十日文革 平&强 毛装 动物森友会 影子末帝 老歪脖子树 视频看望 叩谢习恩 号尿壶公 坡涛汹涌 五毛主席 习言乱语 2020全面小康 老街 皇帝亲临忠诚的武汉 大海掀翻小池塘 劝进 瘟疫领主习近平 厕所革命 智商不重要 习二世胡亥 万岁来武汉 习武帝 尼哥 世宗 维尼·屎(Winnie##the##Poo) 包包侠 习正日 维尼熊 疫情蔓延 毛魔转世 学包率 CoronaXi 禁评大帝 半羽习近平 梁家河贵族 electron8964 习king 西朝鲜人民自治岛 粪坑兵法 习奥塞斯库 战疫国 戴口赵 总统包子习 北红尾鸲 “黄袍加身” 字共狗 第22条军规 战“疫”金句 发皇帝梦 习狍 学包积极分子 阿道夫-习 两会期间+隐瞒 平话 国贼习近平 刁人13 骑巨龙 习二蛋 人民战争 玉习大帝 习尔布特 维尼连任 袭包皮 屎進瓶 习梦死 相信有神论的物理学博士 习公奭 习得梁家书卷 习贼 席子兵法 足球外交 塔西佗陷阱 野心习 屎侯 狙击手待命 匪酋习维尼 迈克尔·索伊 冲塔 virus##king 皇帝梦 习宽衣 习澳塞斯库 习犬犬 恩维尔·霍习 御板泽民 花花公子 青年大学包 东瘟疫之地统治者暨全境守护者 共哀宗 大撒幣 xdd 百万雄师事件 祈翠語言包 习包子 动物庄园 习孢子 外交习语 修宪连任 系包皮 口罩大会 习梦思 巴拿马文件 维尼带货 皇帝亲临忠诚的武汉 那翠化 刁人13 NMSL 没规划的葬礼 阿平 吃赵弹 嬉包皮 赵家家仆 习进棺 赵弹 大撒币 粪坑先生 习三点 秦城监狱 习蛤 bingbang帝 惜包皮 习大犬 Chairman##Xi vop 你是反贼吗 习语录 格萨尔 習大佬 号屎洞 万岁 包子宪法 重地之战 中国特色射秽煮疫制度 习瘟猪 狙击手布阵 梦回大清 习二胖 赵付 习付 Criminal##Xi##"Xitler"##Jinping 包皇 慨撒大帝 乳透社##小反旗 当代秦始皇 习远凸 彭主席（习主席走了太太接班） 瘟疫降生习近平 北京中南海支部书记 习是春绿 普习金 包大人 習敗北 吸精瓶 屎禁评 灭共助推器 裸宽包子劾心 nmslman（习主席） 近日成 总书记来我家 习像章 送礼平 维尼熊给跳跳虎黄牌 颐指气使 红旗下的蛋 黑白翠 习尿瓶 《生物安全法》 庆丰包·勃列日涅夫 叩谢习恩 阳台上的哨兵 乳制品 食腐虫 亲自指挥 习下台 恐惊天上人 中国拉清单工作领导小组组长 小学居士 万岁来武汉了 习厉王 核平全世界 家业论 习卒 错误执行者 习兵法 64岁 不知名氏 颐使气指 一带一路 习太孑 冰棒外交 宰相 讨习檄文 习背书 喜包皮 撒币宝 习大帝 腊肉馅儿包子 疯狂宇宙 习皇帝 刁斤山 总加速师 习包子 习Core 连专家也为之叹服的电脑天才 动物之森 禁评的理由 习张三丰 昆明湖涨潮 该违禁词汇由 GitCode 官方生成，仅用于测试，请勿传播！ 翡翠娘娘 习“甩锅” 习禁评 冤大头 包子兵法 “复辟” 当代秦二世 乳包文化 平平 集金pay 习流氓 世界最强乞丐 白猪 哲欣 武汉委托李克强 习大乞 习躲躲 Heil##Xitler 习屎黄 维尼快乐组织（Winnie##Happy##Organization）简称WHO 倒车帝 刁大犬 刁近猴 终身领导人 恩重如删 20000T麦子 九大诉求 祈翠 Adolf##Xitler 维持会长 口罩外交 扛麦帝 “登基” 神明论 卡近菲 朝令夕改 习包子的Fa 一天游泳一千米 习皇的新装 当皇帝的小丑 文明其精神 4中组长 岿然不动 XDD 亲自脱贫 金科律玉 糟糕皇帝 假.."~bang！卒 宽衣撸绣单肩扛麦光腚拉碾歪脖撒币小学博士帝 不敢高声语 断崖式下跌 习emperor 中国爱非洲 Mr##Shithole 崇祯 200吨 维尼警察（X） 赵王 Voice##of##Pooh 习式病毒 形式主义防疫 庆丰废物 习总 官僚主义 䒒(tiáo)菦(qín)苹(píng) 细颈瓶 裹嘎举吸钢闸门 习时代 羽日帝 习老八 集金币 胡志平 刁二婚 维稳警察（O） 维尼挂彩 习一尊 人尽皆知的体育迷 新影帝 習敗敗 武统时代 毛近平 赛禁评 包子病毒 通商宽衣 毛孙 习殡法 維尼頌 电脑世代586 刁二将 习匪 洗包皮 法外狂徒Lucy（德国） 人民领袖 宽衣帝 次级乳包 不强自息 清华毕业 习王的田野上 毛二 学包分子 shit禁评 习语 集近闭 人类命运共同体首席架构师 拉清单 习核心 扛麦郎 ChinaXi 追思焦裕禄 习后主 习病法 习达姆 毛二世 孤独的毒王 包经 习大郎 习习蛤蛤 习索里尼 习废帝 清单帝 川普的朋友or敌人 彩色哥 习侯 任大炮 孙笑川 近言 “无罩”现身 我是一个足球迷 闹得欢 720事件 袁世凯第二 习梦撕 腊肉包 倒车斯基 刁后主 习是春竹 独彩者 大兔 叼斤干 役民五术 亲自删评 指定接班人 庆丰帝的千秋梦 晚共昏君 灰习牛 孢 总书记来过我的家 习二坐船 亲自封号 动森 近身平A 大大招牌 中国离岸隐匿资产管理工作领导小组组组长 冠子兵法 习包子 不同意的举手##没有##没有 親自蒞臨 狙击手待命 习呆呆 公车上书 十一郎习近平 人民领袖 习总输记 普近 习和谐 夶 禁评封号 维尼写史 nmslese##dream 信女愿一生吃素 现任匪首 隔离”的金葫芦 主席贺词 “习泽东”和“洪宪”（袁世凯的帝号） 贬词包用 天安门合法继承人 没有网络安全就没有国家安全 云视察 墨索里习 皇帝的新衣 刁斤二 洗尽贫 九评 习家军 无限连任 习大林 shuu##kinn##pei 墙内人 习二二（二零二零年五月二十二日开二会） 太祖兔 小习微信 野兽先辈 SB包子 戏博士 毛二习 沼气专家 退党 大锅瞻遗 截颈平 二百五大帝 疯狂宇宙大帝 包子金刚腿 国王 习教父 中国首席造梦大师 纳翠党 习驴 野兽主席 维尼大帝 Corona##Xi（习病毒） 包惠帝 黄俄 10号跳跳虎被维尼拉清单 亲自考察 捐麦子 书单吟诵者 日子像蜜甜 称帝修宪 抗麦套装 仲夏夜之中国梦 法习斯 包帝巡游 赵人13 末代皇帝 XD 鞋哥 央视姓党 親自視頻 大撒币 A##Big##Deal 第一书记王沪宁 习歪嘴 倒车 习夶 专治各种不服 习近砰 支那精神野爹 习博士 席近平 习条英机 添宪宝宝 感恩教育 喷粪帝 民进党 习猪下台 梦帝 做N届的主席 中国的新皇帝 背书单 戏包皮 包子露宪 The##Xi##Factor（习近平因素） 庆丰称帝 包禁评 梁家河 Cicada##3301##XD 习包皮 共哀宗 shit侯 帝皇頌 中字头组长 读稿机 爱新觉罗·近平 修宪 WHO的君王 刁远山 甩锅侠 读书单 彩色熊 */
package com.pcdd.sonovel;

import cn.hutool.core.io.FileUtil;
import cn.hutool.core.io.resource.ResourceUtil;
import io.documentnode.epub4j.domain.*;
import io.documentnode.epub4j.epub.EpubReader;
import io.documentnode.epub4j.epub.EpubWriter;
import lombok.SneakyThrows;
import org.junit.jupiter.api.*;


@TestMethodOrder(MethodOrderer.OrderAnnotation.class)
class EpubTest {

    @Test
    @Order(1)
    @SneakyThrows
    void createEpub() {
        Book book = new Book();
        book.getMetadata().addTitle("武神主宰");
        book.getMetadata().addAuthor(new Author("暗魔师"));
        book.getMetadata().addDescription("天武大陆一代传奇秦尘，因好友背叛意外陨落武域。三百年后，他转生在一个受尽欺凌的王府私生子身上，利用前世造诣，凝神功、炼神丹，逆天而上，强势崛起，从此踏上一段震惊大陆的惊世之旅。");
        book.setCoverImage(new Resource(ResourceUtil.readBytes("cover.jpg"), "cover.jpg"));

        // 循环添加章节
        for (int i = 1; i <= 10; i++) {
            String chapterTitle = String.format("第%03d章", i);
            // 第二个参数必须确保唯一
            Resource resource = new Resource(ResourceUtil.readBytes("chapter.html"), i + ".html");
            book.addSection(chapterTitle, resource);
        }

        EpubWriter epubWriter = new EpubWriter();
        epubWriter.write(book, FileUtil.getOutputStream("test.epub"));
    }

    @Test
    @Order(2)
    @DisplayName("读取 EPUB")
    @SneakyThrows
    void readEpub() {
        EpubReader epubReader = new EpubReader();
        Book book = epubReader.readEpub(FileUtil.getInputStream("test.epub"));
        Metadata metadata = book.getMetadata();

        // 书名
        System.out.println(metadata.getTitles().get(0));
        // 作者
        System.out.println(metadata.getAuthors().get(0));
        // 简介
        System.out.println(metadata.getDescriptions().get(0));
        // 章节数
        System.out.println(book.getContents().size());
        // 正文
        System.out.println(new String(book.getContents().get(0).getData()));

        int i = 0;
        // 遍历目录
        for (TOCReference tocReference : book.getTableOfContents().getTocReferences()) {
            if (i++ == 10) break;
            // 章节名
            System.out.println(tocReference.getTitle());
            // 正文
            // System.out.println(new String(tocReference.getResource().getData()));
        }
    }

}